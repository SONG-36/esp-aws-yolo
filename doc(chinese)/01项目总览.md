# 项目总览文档

## 1 项目背景与目标

​	本项目基于 Espressif 官方社区开源项目 [ESP-SparkBot](https://gitee.com/esp-friends/esp_sparkbot) 的工程框架，原始项目以 ESP32-S3 为核心，集成了语音交互、图像识别、舵机控制与本地 AI 功能，具有较强的完整性和商品化潜力。但原始项目的 AI 能力仍以本地部署为主，且功能侧重于语音播放、2048 游戏、人脸检测等交互展示，**尚未覆盖实际嵌入式 AI 领域中“云端部署+高级识别”的应用需求**。

​	因此，本项目在复用其硬件控制与图像采集模块的基础上，**重点进行以下功能拓展与系统重构**：

（1） **引入 AWS 云端部署架构**：构建 RESTful 接口，实现 YOLOv5、人脸识别、表情识别等模型的在线推理。

（2） **支持本地 / 云端识别双模式切换**：具备云端性能、同时保留本地部署兼容性。

（3）**工程化代码** ：系统设计整体代码，便于后期维护和模块的独立测试

## 2 系统结构

### 2.1 系统架构总览（模块分层）

<img src="./pic/whiteboard_exported_image.png" alt="系统架构图" style="zoom:80%;" />

### 2.2 模块功能说明

（1）云端AI推理服务（AWS EC2/S3）

| 功能            | 实现方式                           | 工具/技术                 |
| --------------- | ---------------------------------- | ------------------------- |
| YOLOv5 目标识别 | 云端 Python Flask + YOLO 模型服务  | AWS EC2 / FastAPI / Flask |
| 可拓展功能      | 加载人脸识别/表情识别/语音识别模型 | OpenCV / InsightFace 等   |
| 通信接口        | HTTP REST API                      | JSON POST 请求            |

（2）ESP32-S3（上层主控模块）

| 功能         | 实现方式                     | 工具/库                 |
| ------------ | ---------------------------- | ----------------------- |
| 图像采集     | OV2640 摄像头模块            | ESP-IDF / Camera driver |
| 图像上传     | JPEG压缩后 POST 上传至 AWS   | Wi-Fi / HTTP Client     |
| 云端结果解析 | 解析 YOLO 返回的 JSON 框坐标 | cJSON / 控制逻辑        |
| 指令下发     | UART Frame 编码              | UART 驱动               |

（3）ESP32-C2（下层运动控制模块）

| 功能     | 实现方式                                 | 工具 / 库                   |
| -------- | ---------------------------------------- | --------------------------- |
| 指令接收 | 通过 UART 接收上层 ESP32-S3 的控制帧     | UART 驱动（ESP-IDF）        |
| 指令解析 | 解析 UART 协议中的控制字段，提取动作信息 | 自定义协议解析 / 状态机实现 |
| 动作执行 | 控制电机执行前进/后退/转向/停止等动作    | 电机 PWM 控制 / GPIO 驱动   |

### 2.3 通信与控制结构

（1）通信结构

<img src="./pic/2.3.png" alt="系统架构图" style="zoom:50%;" />

- 使用 HTTP 协议进行图像传输与识别结果回传；

- 实现边缘设备与 AI 云模型的解耦，提高模型更新灵活性；



（2）控制结构

<img src="./pic/2.32.png" alt="系统架构图" style="zoom:50%;" />

- 使用 UART 串口进行低延时命令下发；
- 保持任务层与硬件驱动层的边界清晰，有利于后续维护与复用；



## 3 项目开发平台与工具

### 3.1 开发硬件平台

| 组件       | 型号       | 用途                                | 说明                       |
| ---------- | ---------- | ----------------------------------- | -------------------------- |
| 上层主控   | ESP32-S3   | 图像采集、Wi-Fi 通信、YOLO 结果交互 | 支持摄像头与 WiFi          |
| 下层驱动   | ESP32-C2   | 电机控制、串口通信                  | 低功耗，仅控制履带         |
| 摄像头模块 | OV2640     | 实时图像采集                        | 与 ESP32-S3 连接           |
| 连接方式   | 4P磁吸接口 | 电源 + UART                         | 两个引脚供电，两个引脚通信 |
| 供电方式   | USB / 电池 | 全系统供电                          | 适配板载电源模块           |

### 3.2 软件平台与操作系统

| 软件/固件      | 平台          | 用途           | 说明                       |
| -------------- | ------------- | -------------- | -------------------------- |
| ESP-IDF v5.3.2 | ESP32 环境    | 开发固件与调试 | 与原开源项目版本一致       |
| FreeRTOS       | MCU RTOS      | 多任务调度     | 上层控制与图像处理任务分离 |
| Ubuntu 20.04   | AWS 云服务器  | 部署 YOLO 模型 | 用于 Python/YOLO 运算      |
| Python 3.9+    | 云端环境      | 推理引擎       | YOLO 模型运行依赖版本      |
| YOLOv5/v8      | PyTorch-based | 云端推理模型   | 可选模型精度/速度平衡      |

### 3.3 云服务平台

| 服务                 | 提供商      | 功能             | 说明               |
| -------------------- | ----------- | ---------------- | ------------------ |
| AWS EC2              | Amazon      | 云服务器主机     | 运行 YOLO 推理模型 |
| AWS S3（可选）       | Amazon      | 数据存储         | 存图或日志         |
| AWS IoT Core（可选） | Amazon      | 设备通信管理     | 统一控制多设备     |
| 网络协议             | HTTP / MQTT | ESP32 ↔ 云端通信 | 控制命令和结果交互 |

### 3.4 开发工具链

| 工具             | 功能          | 说明                         |
| ---------------- | ------------- | ---------------------------- |
| VSCode + WSL     | 编写/烧录代码 | WSL 内配置 ESP-IDF 开发      |
| Git + GitHub     | 版本管理      | 分模块管理 esp-aws-yolo 工程 |
| ESP-IDF          | ESP-IDF IDE   | 若用 VSCode 插件集成也可行   |
| curl / requests  | 网络通信调试  | ESP32 HTTP 接口测试          |
| Jupyter Notebook | 云端调试      | 可部署可视化测试界面         |

