# 系统功能实现与关键模块

​	本章从上层与下层子系统两个维度，详细说明各功能模块的职责、调度方式、通信逻辑和关键算法流程，明确软硬件协同的具体实现机制。包括云服务器模块（AWS）的模块设计。

## 1 上层子系统功能模块（ESP32-S3）

### 1.1 功能概览

<img src="./pic/1.1s3.png" alt="系统架构图" style="zoom: 33%;" />

- **图像采集模块**：通过 OV2640 摄像头获取图像帧。
- **数据上传模块**：将图像数据发送至云端服务器（支持 UART/Wi-Fi MQTT/HTTP）。

- **结果解析模块**：接收云端返回的检测结果（目标类别、方向等）。

- **指令转发模块**：将结果转换为控制指令，通过 UART 下发至 ESP32-C2。

### 1.2 时间调度机制设计

#### 1.2.1 任务设计

（1）调度方式

​	基于 FreeRTOS 的抢占式多任务调度；

（2）任务划分与优先级

| 任务名                  | 优先级 | 周期/触发方式        | 说明                           |
| ----------------------- | ------ | -------------------- | ------------------------------ |
| `camera_task`           | 中     | 周期定时触发         | 图像采集任务，约每 200ms 一帧  |
| `image_upload_task`     | 高     | 事件驱动（图像可用） | 上传图像至云端，支持失败重传   |
| `result_parse_task`     | 高     | 事件驱动（返回结果） | 接收云端推理结果并提取控制信息 |
| `motor_control_tx_task` | 中低   | 事件驱动（指令就绪） | 将控制指令发送至下层 ESP32-C2  |

- `camera_task` 通过定时器驱动，作为系统起点；

- `image_upload_task` 在图像缓冲队列有新图像时启动，优先级高，确保实时上传；

- `result_parse_task` 等待推理结果返回后立即处理，优先级同样高；

- `motor_control_tx_task` 根据解析后的结果再封装并发送控制命令，优先级可略低以避免抢占上传/解析过程。

（3）通信机制

​	使用 FreeRTOS 队列 / 信号量 / 事件组协调任务执行；

（4）超时处理

​	上传失败后退避重传，指令执行超时警告等机制预留。

#### 1.2.2 任务调度时序图



### 1.3 空间域内存与资源管理



### 1.4 模块划分与接口设计

## 2 下层子系统功能模块（ESP32-C2）

### 2.1 功能概览

### 2.2 时间调度机制设计

### 2.3 空间域内存与资源管理

### 2.4 模块划分

## 3 云端服务器模块（AWS）

### 3.1 功能概览

### 3.2 技术栈与部署方案

### 3.3 模块说明

## 4 系统内部通信与交互结构





